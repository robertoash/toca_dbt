version: 2

models:
  - name: fact_purchases
    description: "{{ doc('fact_purchases_table') }}"
    columns:
      - name: event_date
        description: "{{ doc('event_date') }}"
      - name: install_source
        description: "{{ doc('install_source') }}"
      - name: device_category
        description: "{{ doc('device_category') }}"
      - name: product_name
        description: "{{ doc('product_name') }}"
      - name: product_type
        description: "{{ doc('product_type') }}"
      - name: product_subtype
        description: "{{ doc('product_subtype') }}"
      - name: quantity
        description: "{{ doc('quantity') }}"
      - name: price_local
        description: "{{ doc('price_local') }}"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: currency_code
        description: "{{ doc('currency_code') }}"
      - name: revenue_local
        description: "{{ doc('revenue_local') }}"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: price_usd
        description: "{{ doc('price_usd') }}"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: revenue_usd
        description: "{{ doc('revenue_usd') }}"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
  - name: fact_visits
    description: "{{ doc('fact_visits_table') }}"
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - event_date
            - device_category
            - install_source
    columns:
      - name: event_date
        description: "{{ doc('event_date') }}"
        tests:
          - not_null
      - name: install_source
        description: "{{ doc('install_source') }}"
      - name: device_category
        description: "{{ doc('device_category') }}"
      - name: store_impressions
        description: "{{ doc('store_impressions') }}"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: store_entries
        description: "{{ doc('store_entries') }}"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: unique_sessions
        description: "{{ doc('unique_sessions') }}"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: recurring_store_entries
        description: "{{ doc('recurring_store_entries') }}"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: store_entry_conversion_rate
        description: "{{ doc('store_entry_conversion_rate') }}"
  - name: retention_over_time
    description: "{{ doc('retention_over_time_table') }}"
    columns:
      - name: install_date
        description: "{{ doc('install_date') }}"
        tests:
          - not_null
          - unique
      - name: d0_users
        description: "{{ doc('d0_users') }}"
      - name: d1_retained_users
        description: "{{ doc('d1_retained_users') }}"
      - name: d3_retained_users
        description: "{{ doc('d3_retained_users') }}"
      - name: d7_retained_users
        description: "{{ doc('d7_retained_users') }}"
      - name: d1_retention_rate
        description: "{{ doc('d1_retention_rate') }}"
      - name: d3_retention_rate
        description: "{{ doc('d3_retention_rate') }}"
      - name: d7_retention_rate
        description: "{{ doc('d7_retention_rate') }}"
  - name: first_purchase_product
    description: "{{ doc('first_purchase_product_table') }}"
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - first_purchase_date
            - product_name
    columns:
      - name: first_purchase_date
        description: "{{ doc('first_purchase_date') }}"
        tests:
          - not_null
      - name: product_name
        description: "{{ doc('product_name') }}"
      - name: total_first_time_purchases
        description: "{{ doc('total_first_time_purchases') }}"
      - name: product_first_time_purchases
        description: "{{ doc('product_first_time_purchases') }}"
