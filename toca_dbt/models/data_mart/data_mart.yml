version: 2

models:
  - name: fact_purchases
    description: "{{ doc('fact_purchases_table') }}"
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - event_date
            - device_id
            - product_name
    columns:
      - name: event_date
        description: "{{ doc('event_date') }}"
      - name: device_id
        description: "{{ doc('device_id') }}"
      - name: first_telemetry_date
        description: "{{ doc('first_telemetry_date') }}"
      - name: install_source
        description: "{{ doc('install_source') }}"
      - name: device_category
        description: "{{ doc('device_category') }}"
      - name: product_name
        description: "{{ doc('product_name') }}"
      - name: product_type
        description: "{{ doc('product_type') }}"
      - name: product_subtype
        description: "{{ doc('product_subtype') }}"
      - name: quantity
        description: "{{ doc('quantity') }}"
      - name: currency_code
        description: "{{ doc('currency_code') }}"
      - name: revenue_local
        description: "{{ doc('revenue_local') }}"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: revenue_usd
        description: "{{ doc('revenue_usd') }}"
        tests:
          - dbt_utils.expression_is_true:
              expression: ">= 0"
  - name: tracker_retention
    description: "{{ doc('tracker_retention_table') }}"
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - device_id
            - retention_tier
    columns:
      - name: install_date
        description: "{{ doc('install_date') }}"
      - name: device_id
        description: "{{ doc('device_id') }}"
      - name: retention_tier
        description: "{{ doc('retention_tier') }}"
  - name: tracker_player_behavior
    description: "{{ doc('tracker_player_behavior_table') }}"
    columns:
      - name: device_id
        description: "{{ doc('device_id') }}"
      - name: first_telemetry_date
        description: "{{ doc('first_telemetry_date') }}"
      - name: first_store_visit_date
        description: "{{ doc('first_store_visit_date') }}"
      - name: first_purchase_date
        description: "{{ doc('first_purchase_date') }}"
      - name: first_purchase_product
        description: "{{ doc('first_purchase_product') }}"
      - name: first_purchase_product_type
        description: "{{ doc('first_purchase_product_type') }}"
      - name: first_purchase_product_subtype
        description: "{{ doc('first_purchase_product_subtype') }}"
      - name: funnel_step
        description: "{{ doc('funnel_step') }}"
  - name: tracker_exchange_rate_effect
    description: "{{ doc('tracker_exchange_rate_effect_table') }}"
    columns:
      - name: event_date
        description: "{{ doc('event_date') }}"
      - name: currency_code
        description: "{{ doc('currency_code') }}"
      - name: product_name
        description: "{{ doc('product_name') }}"
      - name: exchange_rate
        description: "{{ doc('usd_per_currency') }}"
      - name: exchange_rate_effect
        description: "{{ doc('exchange_rate_effect') }}"
      - name: sold_quantity
        description: "{{ doc('quantity') }}"
  - name: dim_product
    description: "{{ doc('products_table') }}"
    columns:
      - name: product_name
        description: "{{ doc('product_name') }}"
        tests:
          - not_null
          - unique
      - name: product_type
        description: "{{ doc('product_type') }}"
      - name: product_subtype
        description: "{{ doc('product_subtype') }}"
  - name: dim_exchange_rates
    description: "{{ doc('exchange_rates_table') }}"
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - currency_exchange_date
            - currency_code
    columns:
      - name: currency_exchange_date
        description: "{{ doc('currency_exchange_date') }}"
        tests:
          - not_null
      - name: currency_code
        description: "{{ doc('currency_code') }}"
      - name: usd_per_currency
        description: "{{ doc('usd_per_currency') }}"
  - name: dim_date
    description: "{{ doc('dim_date_table') }}"
    columns:
      - name: event_date
        description: "{{ doc('event_date') }}"
      - name: event_week
        description: "{{ doc('event_week') }}"
      - name: event_month
        description: "{{ doc('event_month') }}"
      - name: event_quarter
        description: "{{ doc('event_quarter') }}"
      - name: event_year
        description: "{{ doc('event_year') }}"
